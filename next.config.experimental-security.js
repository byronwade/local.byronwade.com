/**
 * ðŸ”¬ EXPERIMENTAL: Next.js 15+ Security Configuration
 * Industry-Leading Security Implementation (2024-2025)
 * 
 * This configuration enables cutting-edge experimental security features
 * that provide enterprise-grade protection against modern threats.
 * 
 * Features:
 * - Trusted Types API integration
 * - Cross-Origin Isolation (COEP/COOP)
 * - Document-Isolation-Policy (experimental)
 * - Comprehensive Permissions Policy
 * - CVE-2025-29927 protection
 * - Advanced CSP with experimental directives
 * - Performance optimizations for security
 * 
 * @version 15.4+
 * @experimental
 */

/** @type {import('next').NextConfig} */\nconst nextConfig = {\n  // =========================================================================\n  // CORE CONFIGURATION\n  // =========================================================================\n  \n  // Use the latest React and experimental features\n  reactStrictMode: true,\n  \n  // Enable SWC minification for better performance\n  swcMinify: true,\n  \n  // Enable Next.js 15+ experimental features\n  experimental: {\n    // Security-related experimental features\n    authInterrupts: true, // Enable forbidden() and unauthorized() APIs\n    browserDebugInfoInTerminal: true, // Forward browser logs for debugging\n    dynamicIO: true, // Enable new caching behavior\n    clientSegmentCache: true, // Optimize client-side router\n    globalNotFound: true, // Global 404 handling\n    turbopackPersistentCaching: true, // Enable persistent caching\n    \n    // Performance optimizations\n    optimizePackageImports: [\n      '@/lib/utils',\n      '@/components/ui',\n      'lucide-react',\n      'date-fns',\n      'lodash-es'\n    ],\n    \n    // Enable modern JavaScript features\n    esmExternals: true,\n    \n    // Enable experimental CSS features\n    cssChunking: 'strict',\n    inlineCss: false, // Disable for better CSP compliance\n    \n    // Security-focused experimental features\n    strictNextHead: true,\n    newNextLinkBehavior: true,\n    \n    // Enable experimental bundling optimizations\n    serverComponentsExternalPackages: [\n      'bcrypt',\n      'node-gyp',\n      'sqlite3'\n    ]\n  },\n  \n  // =========================================================================\n  // ADVANCED SECURITY CONFIGURATION\n  // =========================================================================\n  \n  // Security headers with experimental features\n  async headers() {\n    return [\n      {\n        source: '/(.*)',\n        headers: [\n          // ===== CORE SECURITY HEADERS =====\n          {\n            key: 'X-Frame-Options',\n            value: 'DENY'\n          },\n          {\n            key: 'X-Content-Type-Options',\n            value: 'nosniff'\n          },\n          {\n            key: 'X-XSS-Protection',\n            value: '1; mode=block'\n          },\n          {\n            key: 'Referrer-Policy',\n            value: 'strict-origin-when-cross-origin'\n          },\n          {\n            key: 'X-DNS-Prefetch-Control',\n            value: 'off'\n          },\n          \n          // ===== HTTPS ENFORCEMENT =====\n          {\n            key: 'Strict-Transport-Security',\n            value: 'max-age=31536000; includeSubDomains; preload'\n          },\n          \n          // ===== EXPERIMENTAL: TRUSTED TYPES =====\n          {\n            key: 'Content-Security-Policy',\n            value: [\n              \"default-src 'self'\",\n              \"script-src 'self' 'unsafe-inline' 'unsafe-eval' https://vercel.live\",\n              \"style-src 'self' 'unsafe-inline' https://fonts.googleapis.com\",\n              \"img-src 'self' data: https: blob:\",\n              \"font-src 'self' https://fonts.gstatic.com\",\n              \"connect-src 'self' https: wss:\",\n              \"media-src 'self' https:\",\n              \"object-src 'none'\",\n              \"base-uri 'self'\",\n              \"form-action 'self'\",\n              \"frame-ancestors 'none'\",\n              \"upgrade-insecure-requests\",\n              // Trusted Types directives (experimental)\n              \"require-trusted-types-for 'script'\",\n              \"trusted-types default businessContent analytics 'allow-duplicates'\"\n            ].join('; ')\n          },\n          \n          // ===== EXPERIMENTAL: CROSS-ORIGIN ISOLATION =====\n          {\n            key: 'Cross-Origin-Embedder-Policy',\n            value: 'credentialless' // More compatible than require-corp\n          },\n          {\n            key: 'Cross-Origin-Opener-Policy',\n            value: 'same-origin'\n          },\n          \n          // ===== EXPERIMENTAL: DOCUMENT ISOLATION POLICY =====\n          // Note: Only supported in Chrome with experimental flags\n          {\n            key: 'Document-Isolation-Policy',\n            value: 'isolate-and-credentialless'\n          },\n          {\n            key: 'Document-Isolation-Policy-Report-Only',\n            value: 'isolate-and-credentialless'\n          },\n          \n          // ===== EXPERIMENTAL: COMPREHENSIVE PERMISSIONS POLICY =====\n          {\n            key: 'Permissions-Policy',\n            value: [\n              // Media capture\n              'camera=()',\n              'microphone=()',\n              'display-capture=()',\n              'captured-surface-control=()',\n              \n              // Location and sensors\n              'geolocation=()',\n              'accelerometer=()',\n              'gyroscope=()',\n              'magnetometer=()',\n              'ambient-light-sensor=()',\n              \n              // Experimental privacy features\n              'attribution-reporting=()',\n              'browsing-topics=()',\n              'private-aggregation=()',\n              'shared-storage=()',\n              'shared-storage-select-url=()',\n              \n              // Device integration\n              'usb=()',\n              'serial=()',\n              'bluetooth=()',\n              'hid=()',\n              \n              // AI and ML\n              'compute-pressure=()',\n              'language-detector=()',\n              'translator=()',\n              'summarizer=()',\n              \n              // Authentication\n              'identity-credentials-get=()',\n              'otp-credentials=()',\n              \n              // Fonts and storage\n              'local-fonts=()',\n              'storage-access=()',\n              \n              // Allowed features\n              'fullscreen=(self)',\n              'picture-in-picture=(self)',\n              'screen-wake-lock=(self)',\n              'publickey-credentials-create=(self)',\n              'publickey-credentials-get=(self)',\n              'cross-origin-isolated=(self)'\n            ].join(', ')\n          },\n          \n          // ===== EXPERIMENTAL: CROSS-ORIGIN RESOURCE POLICY =====\n          {\n            key: 'Cross-Origin-Resource-Policy',\n            value: 'cross-origin'\n          },\n          \n          // ===== EXPERIMENTAL: ORIGIN AGENT CLUSTER =====\n          {\n            key: 'Origin-Agent-Cluster',\n            value: '?1'\n          },\n          \n          // ===== EXPERIMENTAL: SUPPORTS LOADING MODE =====\n          {\n            key: 'Supports-Loading-Mode',\n            value: 'fenced-frame'\n          },\n          \n          // ===== PERFORMANCE AND MONITORING =====\n          {\n            key: 'Timing-Allow-Origin',\n            value: '*'\n          },\n          {\n            key: 'Server-Timing',\n            value: 'total;dur=0'\n          },\n          \n          // ===== REPORTING =====\n          {\n            key: 'Report-To',\n            value: JSON.stringify({\n              group: 'security-reports',\n              max_age: 86400,\n              endpoints: [{\n                url: '/api/security/reports'\n              }]\n            })\n          },\n          {\n            key: 'Reporting-Endpoints',\n            value: 'security-reports=\"/api/security/reports\"'\n          },\n          \n          // ===== SECURITY CONTEXT =====\n          {\n            key: 'X-Security-Suite',\n            value: 'experimental-2025'\n          },\n          {\n            key: 'X-CVE-Protection',\n            value: 'CVE-2025-29927'\n          }\n        ]\n      },\n      \n      // Special headers for API routes\n      {\n        source: '/api/(.*)',\n        headers: [\n          {\n            key: 'Cross-Origin-Opener-Policy',\n            value: 'same-origin-allow-popups' // Allow OAuth popups\n          },\n          {\n            key: 'Cache-Control',\n            value: 'no-store, must-revalidate'\n          },\n          {\n            key: 'X-Robots-Tag',\n            value: 'noindex, nofollow'\n          }\n        ]\n      },\n      \n      // Admin routes - maximum security\n      {\n        source: '/admin/(.*)',\n        headers: [\n          {\n            key: 'Cross-Origin-Embedder-Policy',\n            value: 'require-corp' // Stricter for admin\n          },\n          {\n            key: 'Permissions-Policy',\n            value: [\n              'camera=()',\n              'microphone=()',\n              'geolocation=()',\n              'attribution-reporting=()',\n              'browsing-topics=()',\n              'storage-access=()',\n              'cross-origin-isolated=(self)'\n            ].join(', ')\n          },\n          {\n            key: 'X-Security-Level',\n            value: 'maximum'\n          }\n        ]\n      }\n    ];\n  },\n  \n  // =========================================================================\n  // SECURITY REDIRECTS AND REWRITES\n  // =========================================================================\n  \n  async redirects() {\n    return [\n      // Redirect HTTP to HTTPS in production\n      ...(process.env.NODE_ENV === 'production' ? [\n        {\n          source: '/(.*)',\n          has: [\n            {\n              type: 'header',\n              key: 'x-forwarded-proto',\n              value: 'http'\n            }\n          ],\n          destination: 'https://' + process.env.VERCEL_URL + '/$1',\n          permanent: true\n        }\n      ] : []),\n      \n      // Security redirects for known vulnerable paths\n      {\n        source: '/wp-admin/:path*',\n        destination: '/404',\n        permanent: true\n      },\n      {\n        source: '/.env',\n        destination: '/404',\n        permanent: true\n      },\n      {\n        source: '/admin.php',\n        destination: '/404',\n        permanent: true\n      }\n    ];\n  },\n  \n  // =========================================================================\n  // PERFORMANCE OPTIMIZATIONS\n  // =========================================================================\n  \n  // Compress responses\n  compress: true,\n  \n  // Generate ETags for caching\n  generateEtags: true,\n  \n  // Optimize builds\n  webpack: (config, { dev, isServer }) => {\n    // Security-focused webpack optimizations\n    if (!dev) {\n      // Remove source maps in production for security\n      config.devtool = false;\n      \n      // Add security-focused optimizations\n      config.optimization = {\n        ...config.optimization,\n        minimize: true,\n        minimizer: [\n          ...config.optimization.minimizer,\n          // Add additional minification for security\n        ]\n      };\n    }\n    \n    // Performance budgets for security\n    config.performance = {\n      maxAssetSize: 250000, // 250KB\n      maxEntrypointSize: 500000, // 500KB\n      hints: dev ? 'warning' : 'error'\n    };\n    \n    return config;\n  },\n  \n  // =========================================================================\n  // OUTPUT CONFIGURATION\n  // =========================================================================\n  \n  // Standalone output for better security isolation\n  output: 'standalone',\n  \n  // =========================================================================\n  // ENVIRONMENT VARIABLES\n  // =========================================================================\n  \n  env: {\n    SECURITY_SUITE_VERSION: '1.0.0-experimental',\n    SECURITY_FEATURES_ENABLED: 'trusted-types,cross-origin-isolation,document-isolation,permissions-policy'\n  },\n  \n  // =========================================================================\n  // IMAGE OPTIMIZATION WITH SECURITY\n  // =========================================================================\n  \n  images: {\n    // Domains for security scanning\n    remotePatterns: [\n      {\n        protocol: 'https',\n        hostname: '**.vercel.app'\n      },\n      {\n        protocol: 'https',\n        hostname: 'images.unsplash.com'\n      }\n    ],\n    \n    // Security settings\n    dangerouslyAllowSVG: false,\n    contentSecurityPolicy: \"default-src 'self'; script-src 'none'; sandbox;\",\n    \n    // Performance settings\n    formats: ['image/webp', 'image/avif'],\n    minimumCacheTTL: 60,\n    \n    // Size limits for security\n    deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],\n    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384]\n  },\n  \n  // =========================================================================\n  // TYPESCRIPT CONFIGURATION\n  // =========================================================================\n  \n  typescript: {\n    // Ignore type errors in development for faster builds\n    ignoreBuildErrors: false\n  },\n  \n  // =========================================================================\n  // ESLINT CONFIGURATION\n  // =========================================================================\n  \n  eslint: {\n    // Enforce linting during builds\n    ignoreDuringBuilds: false,\n    dirs: ['app', 'lib', 'components', '.security']\n  },\n  \n  // =========================================================================\n  // TRANSPILATION\n  // =========================================================================\n  \n  transpilePackages: [\n    // Security-related packages that need transpilation\n    'dompurify'\n  ],\n  \n  // =========================================================================\n  // LOGGING AND MONITORING\n  // =========================================================================\n  \n  logging: {\n    fetches: {\n      fullUrl: process.env.NODE_ENV === 'development'\n    }\n  },\n  \n  // =========================================================================\n  // CUSTOM CONFIGURATION FOR SECURITY SUITE\n  // =========================================================================\n  \n  // Custom configuration for our experimental security suite\n  security: {\n    experimental: {\n      trustedTypes: {\n        enabled: true,\n        policies: ['default', 'businessContent', 'analytics']\n      },\n      crossOriginIsolation: {\n        enabled: true,\n        mode: 'credentialless'\n      },\n      documentIsolationPolicy: {\n        enabled: false, // Chrome-only experimental feature\n        mode: 'credentialless'\n      },\n      permissionsPolicy: {\n        enabled: true,\n        restrictive: true\n      },\n      cveProtection: {\n        'CVE-2025-29927': true // Middleware bypass protection\n      }\n    }\n  }\n};\n\n// Environment-specific overrides\nif (process.env.NODE_ENV === 'development') {\n  // Development-specific security settings\n  nextConfig.experimental.authInterrupts = true;\n  nextConfig.experimental.browserDebugInfoInTerminal = true;\n} else if (process.env.NODE_ENV === 'production') {\n  // Production-specific security settings\n  nextConfig.experimental.strictNextHead = true;\n  nextConfig.poweredByHeader = false;\n}\n\nmodule.exports = nextConfig;